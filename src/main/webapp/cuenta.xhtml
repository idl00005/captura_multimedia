<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
<f:metadata>
   <f:viewAction action="#{loginController.checkRole}" />
</f:metadata>
<ui:composition template="/WEB-INF/templates/template.xhtml">
   <ui:define name="content">
      <div class="container" style="width: 50%;">
         <h2>Perfil de Usuario</h2>
         <div class="form-group my-1">
            <h:outputLabel for="imageUpload" value="Foto de pefil"/>
            <h:inputFile id="imageUpload" styleClass="form-control" onchange="displayImage(this)"/>
         </div>
         <div class="form-group my-1">
            <img id="profileImage" src="img/foto_perfil_por_defecto.webp" alt="Profile Image" style="width: 100px; height: 100px;"/>
         </div>
         <h:form styleClass="form">
            <div class="form-group my-1">
               <h:outputLabel for="nombre" value="Nombre"/>
               <h:inputText id="nombre" value="#{cuentaController.user.nombre}" readonly="true" styleClass="form-control"/>
            </div>
            <div class="form-group my-1">
               <h:outputLabel for="apellidos" value="Apellidos"/>
               <h:inputText id="apellidos" value="#{cuentaController.user.apellidos}" readonly="true" styleClass="form-control"/>
            </div>
            <div class="form-group my-1">
               <h:outputLabel for="dni" value="DNI"/>
               <h:inputText id="dni" value="#{cuentaController.user.dni}" readonly="true" styleClass="form-control"/>
            </div>
            <div class="form-group my-1">
               <h:outputLabel for="cp" value="Código Postal"/>
               <h:inputText id="cp" value="#{cuentaController.user.cp}" styleClass="form-control" required="true" requiredMessage="El campo no debe quedar vacio."/>
               <h:message for="cp" escape="false" style="color: red"></h:message>
            </div>
            <div class="form-group my-1">
               <h:outputLabel for="ciudad" value="Ciudad"/>
               <h:inputText id="ciudad" value="#{cuentaController.user.ciudad}" styleClass="form-control" required="true" requiredMessage="El campo no debe quedar vacio."/>
               <h:message for="ciudad" escape="false" style="color: red"></h:message>
            </div>
            <div class="form-group my-1">
               <h:outputLabel for="direccion" value="Dirección"/>
               <h:inputText id="direccion" value="#{cuentaController.user.direccion}" styleClass="form-control" required="true" requiredMessage="El campo no debe quedar vacio."/>
               <h:message for="direccion" escape="false" style="color: red"></h:message>
            </div>
            <div class="form-group my-1">
               <h:outputLabel for="telefono" value="Teléfono"/>
               <h:inputText id="telefono" value="#{cuentaController.user.telefono}" styleClass="form-control" required="true" requiredMessage="El campo no debe quedar vacio."/>
               <h:message for="telefono" escape="false" style="color: red"></h:message>
            </div>
            <div class="form-group my-1">
               <h:outputLabel for="email" value="Correo Electrónico"/>
               <h:inputText id="email" value="#{cuentaController.user.email}" styleClass="form-control" required="true" requiredMessage="El campo no debe quedar vacio."/>
               <h:message for="email" escape="false" style="color: red"></h:message>
            </div>
            <h:commandButton value="Actualizar" action="#{cuentaController.updateUser}" styleClass="btn btn-warning m-2"/>
         </h:form>
         <hr/>
         <p><strong>Duración de la membresía:</strong> 1 año</p>
      </div>
   </ui:define>
</ui:composition>
<script type="text/javascript">
   window.onload = function() {
      function displayImage(input) {
         if (input.files &amp;&amp; input.files[0]) {
            var reader = new FileReader();
            reader.onload = function(e) {
               document.getElementById('profileImage').src = e.target.result;
            }
            reader.readAsDataURL(input.files[0]);
         }
      }

      const profileImage = document.getElementById('profileImage');

      profileImage.addEventListener('drop', (e) => {
         e.stopPropagation();
         e.preventDefault();

         displayImage(e.dataTransfer.files);
      });

      profileImage.addEventListener('dragover', (e) => {
         e.stopPropagation();
         e.preventDefault();

         e.dataTransfer.dropEffect = 'copy';
      });
   }
</script>
</html>